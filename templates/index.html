<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ramadan Kitchen</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@700&family=Cinzel+Decorative:wght@700&family=Patrick+Hand&family=Inter:wght@400;600&family=Amiri:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div class="hanging-poster">
      <div class="pin"></div>
      <h1>Ramadan Mubarak</h1>
      <p>May your days be filled with peace</p>
    </div>

    <div class="wall-display">
      <div class="date-row">
        <span id="hijri-date">Loading Hijri...</span> ‚Ä¢
        <span id="english-date">Loading...</span>
      </div>
      <div class="prayer-row">
        <div class="time-card">
          <span class="label">Sehri Ends</span>
          <span class="time" id="sehri-time">--:--</span>
        </div>
        <div class="divider"></div>
        <div class="time-card">
          <span class="label">Iftar Time</span>
          <span class="time" id="iftar-time">--:--</span>
        </div>
      </div>
      <div class="location-label">üìç Based on Mecca</div>
    </div>

    <button class="start-btn" id="start-btn" onclick="openKitchen()">
      ‚ú® Open Kitchen ‚ú®
    </button>

    <div class="counter-top" id="scene">
      <div class="book-stand">
        <div class="book" id="the-book">
          <div class="cover-flap">
            <div class="cover-front">
              <div class="cover-content">
                <h1>Ramadan<br />Recipes</h1>
                <p>Tap button to open</p>
              </div>
            </div>
            <div class="cover-back">
              <div class="notes-page">
                <h3>Notes</h3>
                <p>Made with love.</p>
              </div>
            </div>
          </div>
          <div class="pages-right">
            <h2 class="recipe-title" id="r-title">...</h2>
            <p class="recipe-meta" id="r-meta">...</p>
            <div class="recipe-text" id="r-desc">
              Summoning deliciousness...
            </div>
            <p class="bismillah">~ Bismillah ~</p>
          </div>
        </div>
      </div>

      <div class="ipad-stand">
        <div class="ipad-screen">
          <iframe
            id="ipad-video"
            src=""
            allow="autoplay; encrypted-media"
            allowfullscreen
          ></iframe>
          <div id="video-error" class="fallback-msg">
            <p>Video embedding disabled by owner.</p>
            <a id="yt-link" href="#" target="_blank" class="yt-btn"
              >Watch on YouTube</a
            >
          </div>
        </div>
        <div class="ipad-home-bar"></div>
      </div>
    </div>

    <script>
      window.onload = function () {
        fetchRamadanData();
      };

      async function fetchRamadanData() {
        const apiURL =
          "https://api.aladhan.com/v1/timingsByCity?city=Mecca&country=Saudi%20Arabia&method=4";
        try {
          const res = await fetch(apiURL);
          const data = await res.json();
          const timings = data.data.timings;
          const date = data.data.date;
          document.getElementById("english-date").innerText = date.readable;
          document.getElementById("hijri-date").innerText =
            `${date.hijri.day} ${date.hijri.month.en} ${date.hijri.year}`;
          document.getElementById("sehri-time").innerText =
            timings.Fajr.split(" ")[0];
          document.getElementById("iftar-time").innerText =
            timings.Maghrib.split(" ")[0];
        } catch (e) {
          console.error(e);
        }
      }

      async function openKitchen() {
        const btn = document.getElementById("start-btn");
        btn.style.opacity = "0";
        setTimeout(() => (btn.style.display = "none"), 400);
        await fetchRecipe();
        const scene = document.getElementById("scene");
        scene.style.transform = "translate(-50%, -45%) scale(1)";
        setTimeout(() => {
          document.getElementById("the-book").classList.add("open");
        }, 1000);
      }

      async function fetchRecipe() {
        try {
          const res = await fetch(
            "https://www.themealdb.com/api/json/v1/1/random.php",
          );
          const data = await res.json();
          const meal = data.meals[0];
          document.getElementById("r-title").innerText = meal.strMeal;
          document.getElementById("r-meta").innerText =
            `${meal.strArea} Cuisine ‚Ä¢ ${meal.strCategory}`;
          document.getElementById("r-desc").innerText = meal.strInstructions;

          const videoError = document.getElementById("video-error");
          const iframe = document.getElementById("ipad-video");
          if (meal.strYoutube) {
            const videoId = meal.strYoutube.split("v=")[1];
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&enablejsapi=1`;
            iframe.style.display = "block";
            videoError.style.display = "none";
            document.getElementById("yt-link").href = meal.strYoutube;
          } else {
            iframe.style.display = "none";
            videoError.style.display = "flex";
            videoError.querySelector("p").innerText = "No video available.";
          }
        } catch (e) {
          alert("Network Error");
        }
      }
    </script>
  </body>
</html>
