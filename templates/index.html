<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ramadan Kitchen</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Patrick+Hand&family=Inter:wght@400;600&family=Amiri:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div class="wall-display">
      <div class="date-row">
        <div class="arabic-date" id="hijri-date">Loading Hijri...</div>
        <div class="english-date" id="english-date">Loading Date...</div>
      </div>

      <div class="prayer-row">
        <div class="time-card">
          <span class="label">Sehri Ends</span>
          <span class="time" id="sehri-time">--:--</span>
        </div>
        <div class="divider"></div>
        <div class="time-card">
          <span class="label">Iftar Time</span>
          <span class="time" id="iftar-time">--:--</span>
        </div>
      </div>
      <div class="location-label">üìç Based on Mecca (Standard)</div>
    </div>

    <button class="start-btn" id="start-btn" onclick="openKitchen()">
      ‚ú® Prepare Iftar ‚ú®
    </button>

    <div class="counter-top" id="scene">
      <div class="book-stand">
        <div class="book" id="the-book">
          <div class="cover-flap">
            <div class="cover-front">
              <div>
                <h1
                  style="
                    font-size: 2.8rem;
                    margin: 0;
                    text-shadow: 2px 2px 0px #3e2723;
                  "
                >
                  Ramadan<br />Secrets
                </h1>
                <p style="margin: 5px 0; color: #e3b584">Tap button to open</p>
              </div>
            </div>
            <div class="cover-back">
              <div style="text-align: center; opacity: 0.6">
                <h3
                  style="
                    font-family: &quot;Cinzel Decorative&quot;;
                    color: #5d4037;
                  "
                >
                  Notes
                </h3>
                <p style="font-family: &quot;Patrick Hand&quot;">
                  Made with love.
                </p>
              </div>
            </div>
          </div>

          <div class="pages-right">
            <h2 class="recipe-title" id="r-title">...</h2>
            <p class="recipe-meta" id="r-meta">...</p>
            <div class="recipe-text" id="r-desc">
              Summoning deliciousness...
            </div>
            <p class="bismillah">~ Bismillah ~</p>
          </div>
        </div>
      </div>

      <div class="ipad-stand">
        <div class="ipad-screen">
          <iframe
            id="ipad-video"
            src=""
            allow="autoplay; encrypted-media"
            allowfullscreen
          ></iframe>

          <div id="video-error" class="fallback-msg">
            <p>Video embedding disabled by owner.</p>
            <a id="yt-link" href="#" target="_blank" class="yt-btn"
              >Watch on YouTube</a
            >
          </div>
        </div>
        <div class="ipad-home-bar"></div>
      </div>
    </div>

    <script>
      // --- 1. INITIALIZE DATA (Date & Prayer Times) ---
      window.onload = function () {
        fetchRamadanData();
      };

      async function fetchRamadanData() {
        // Using Aladhan API for accurate Hijri Date & Prayer Times
        // NOTE: You can change 'city=Mecca' and 'country=SA' to your specific location
        const apiURL =
          "https://api.aladhan.com/v1/timingsByCity?city=Mecca&country=Saudi%20Arabia&method=4";

        try {
          const res = await fetch(apiURL);
          const data = await res.json();
          const timings = data.data.timings;
          const date = data.data.date;

          // 1. Set Dates
          document.getElementById("english-date").innerText = date.readable;
          document.getElementById("hijri-date").innerText =
            `${date.hijri.day} ${date.hijri.month.en} ${date.hijri.year}`;

          // 2. Set Times (Fajr = Sehri End, Maghrib = Iftar)
          document.getElementById("sehri-time").innerText = formatTime(
            timings.Fajr,
          );
          document.getElementById("iftar-time").innerText = formatTime(
            timings.Maghrib,
          );
        } catch (e) {
          console.error("Error fetching times:", e);
          document.getElementById("hijri-date").innerText = "Ramadan Mubarak";
        }
      }

      // Helper to clean up time string (remove timezone info if present)
      function formatTime(timeStr) {
        return timeStr.split(" ")[0]; // Returns "04:30" from "04:30 (+03)"
      }

      // --- 2. EXISTING ANIMATION LOGIC ---
      async function openKitchen() {
        const btn = document.getElementById("start-btn");
        btn.style.opacity = "0";
        setTimeout(() => (btn.style.display = "none"), 400);

        await fetchRecipe();

        const scene = document.getElementById("scene");
        scene.style.transform = "translateY(0)";

        setTimeout(() => {
          document.getElementById("the-book").classList.add("open");
        }, 1000);
      }

      // --- 3. EXISTING RECIPE FETCH LOGIC ---
      async function fetchRecipe() {
        try {
          const res = await fetch(
            "https://www.themealdb.com/api/json/v1/1/random.php",
          );
          const data = await res.json();
          const meal = data.meals[0];

          document.getElementById("r-title").innerText = meal.strMeal;
          document.getElementById("r-meta").innerText =
            `${meal.strArea} Cuisine ‚Ä¢ ${meal.strCategory}`;
          document.getElementById("r-desc").innerText = meal.strInstructions;

          const videoError = document.getElementById("video-error");
          const iframe = document.getElementById("ipad-video");

          if (meal.strYoutube) {
            const videoId = meal.strYoutube.split("v=")[1];
            // Added enablejsapi=1 for better control
            const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&enablejsapi=1`;
            iframe.src = embedUrl;
            iframe.style.display = "block";
            videoError.style.display = "none";
            document.getElementById("yt-link").href = meal.strYoutube;
          } else {
            iframe.style.display = "none";
            videoError.style.display = "flex";
            videoError.querySelector("p").innerText =
              "No video available for this recipe.";
          }
        } catch (e) {
          console.error(e);
          alert("Network Error. Try refreshing!");
        }
      }
    </script>
  </body>
</html>
